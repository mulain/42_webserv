<!DOCTYPE html>
<html>
<head>
	<title>Test Website for 42 Project: webserv</title>
	<link rel="stylesheet" type="text/css" href="styles.css"/>
</head>
<body>
	<header>
		<h1>webserv testing</h1>
	</header>
	<div class="content_left">
		<h2>Test stuff by:</h2>
		<ul>
			<li>entering text to upload</li>
			<li>choosing a file to upload</li>
			<li>visiting the cookie tracking log</li>
			<li>visiting the CGI testing page <tiny> via a http redirection omg!</tiny> </li>
			
		</ul>
		<br>
		<br>
		<div class="input-container_01">
			<input type="text" id="input" name="input" class="input_01" placeholder="Enter your text">
			<button class="button_01" onclick="submitText()">Submit Text</button>
		</div>
		<br>
		<br>
		<div class="input-container_01">
			<input type="file" id="image" name="image" class="input_01">
			<button class="button_01" onclick="submitImage()">Submit Image</button>
		</div>
		<br>
		<br>
		<a href="/sessionLog.html">
			<button class="button_01">Go to session log</button>
		</a>
		<br>
		<br>
		<a href="/fakeLocationThatDoesntExist/">
			<button class="button_01">Go to CGI page</button>
		</a>
		
	</div>
	<img class="img_float_right" src="/img/catFace.jpg">

	<script>
		const textEndpointUrl = '/api/text.txt';
		const fileBaseEndpointUrl = '/api/';

		function submitText() {
			const input = document.getElementById('input').value;
			sendData(input, textEndpointUrl);
		}

		function submitImage() {
			const fileInput = document.getElementById('image');
			const file = fileInput.files[0];
			sendData(file, fileBaseEndpointUrl + encodeURIComponent(file.name));
		}

		function sendData(data, endpointUrl) {
			const xhr = new XMLHttpRequest();
			xhr.open('POST', endpointUrl, true);
			xhr.onload = function() {
				if (this.status === 200) {
					document.getElementById('output').innerHTML = this.responseText;
				}
			};

			if (data instanceof File) {
				xhr.setRequestHeader('Content-Type', data.type);
				xhr.setRequestHeader('X-File-Name', data.name);
				xhr.send(data);
			} else {
				xhr.setRequestHeader('Content-Type', 'text/plain');
				xhr.setRequestHeader('X-File-Name', 'text.txt');
				xhr.send(data);
			}
		}
	</script>
</body>
</html>
